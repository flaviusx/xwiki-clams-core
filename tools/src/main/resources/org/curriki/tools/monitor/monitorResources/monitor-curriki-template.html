<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Monitor Curriki</title>
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="js/excanvas.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="js/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery.jqplot.min.js"></script>
    <link rel="stylesheet" type="text/css" href="js/jquery.jqplot.min.css" />
</head>
<body style="width:99%">
<h1><a href="../">Monitor Curiki</a></h1>

<p>Report on: from ^startDate^ to ^endDate^</p>

<div id="chartdiv" style="height:100px;width:99%;"></div>

<script type="text/javascript" src="topsCpuLoad.js"></script>
<script type="text/javascript" src="js/logRoller.js"></script>
<script type="text/javascript">
    window.duration = 60
    window.granularity = 5;
    window.maxCpuLoad = ^maxCpuLoad^;
    ^cacheEvictions^;
    ^pageLoadMeasures^;


    function clickedOnPlot(ev, gridpos, datapos, neighbor, plot) {
         var x = datapos.xaxis, y = datapos.yaxis;
         x = Math.round(x/granularity)*granularity;
         console.log("click!", x);
        Curriki.monitor.renewPlot(x, null, null);
        positionWindows(x);
    }
    $.jqplot.eventListenerHooks.push(['jqplotClick', clickedOnPlot]);

    /* $.jqplot('chartdiv',  [cpuLoad],
        { title:'Load',
            axes:{xaxis:{min:0, max:60}, yaxis:{min:0, max:maxCpuLoad}},
            series:[{color:'#5FAB78', title: "Appserv CPU"}]
        }); */

    function adjustTops(p) {
        jQuery.ajax({ context:document.body,
                    url: "topsHeader_" + p + ".txt",
                    success: function(data) {
                      //console.log("Data received: " + data);
                      $('#topHeader').html(data);
                    }});
    }

    function positionWindows(p) {
        p = Math.round(p/granularity)*granularity;
        adjustTops(p);
        frames['apacheLogs'].Curriki.monitor.rollToTime(Math.round(p));
        frames['appservLogs'].Curriki.monitor.rollToTime(Math.round(p));
        frames['threads'].Curriki.monitor.jumpToTimePage(Math.round(p), granularity);
        frames['mysql'].Curriki.monitor.jumpToTimePage(Math.round(p), granularity);
    }

    $('document').ready( function() {
                adjustTops(0);
                Curriki.monitor.renewPlot(null, null, null);
            }
    );
</script>

<div style="font-size:small; padding:0.2em; margin: 0.2em ">
    <pre id="topHeader">Loading...</pre>
</div>

<hr>
<h3>Apache Log</h3>
<form action="."
    onsubmit="Curriki.monitor.searchALog(this, 'apacheLogs'); return false;"
        >Search: <input name="txt"></form>
<p style="font-size: smaller">LogFormat is %h %l %u %t %D User:%{username}C "%r" %>s %b "%{Referer}i" "%{User-Agent}i"
    (in <a href="http://httpd.apache.org/docs/current/mod/mod_log_config.html">mod_log_config</a>).</p>
<iframe style="width:90%; height:10em" src="apacheLogs.html" name="apacheLogs">
</iframe>



<hr>
<h3>Appserv Log</h3>
<form action="."
    onsubmit="Curriki.monitor.searchALog(this, 'appservLogs'); return false;"
        >Search: <input name="txt"></form>
<iframe style="width:90%; height:10em" src="appservLogs.html" name="appservLogs">
</iframe>


<hr>
<h3>Appserv Threads</h3>
<iframe style="width:90%; height:10em " src="threads_0.html" name="threads">
</iframe>


<hr>
<h3>MySQL queries</h3>
<iframe style="width:90%; height:10em " src="mysqlProcesses_0.html" name="mysql">
</iframe>


</body>
</html>